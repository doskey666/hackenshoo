{"paragraphs":[{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1465069773582_823726282","id":"20160604-224933_751040776","dateCreated":"Jun 4, 2016 10:49:33 PM","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:216","text":"%dep\nz.reset()\nz.addRepo(\"Spark Packages Repo\").url(\"http://dl.bintray.com/spark-packages/maven\")\nz.addRepo(\"spray repo\").url(\"http://repo.spray.io\")\n\nz.load(\"com.databricks:spark-csv_2.11:1.3.0\")\n","dateUpdated":"Jun 4, 2016 10:49:52 PM"},{"title":"Create events table","text":"%sql\n\nCREATE EXTERNAL TABLE `events`(\n  `targeting_id` string,  `ad_id_hash` string,  `campaign_id` string,  `country` string,\n  `lang` string,  `create_date` timestamp,  `quantity` string,  `browser_type` string,\n  `city` string,  `adgroup_id` int,  `device` int,  `profile_id` string,  `type` string,\n  `value` string,  `referrer` string,  `network_type` string,  `user_identifier` string,\n  `subnet_class_c` string,  `client_ip` string,  `advertiser_identifier` string)\nPARTITIONED BY(event_month INT)\nROW FORMAT SERDE\n  'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'\nSTORED AS INPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat'\nOUTPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'\nLOCATION 's3://kenshoo-data-hackathon/hive/events_for_hackathon_v4/parquet'\n","dateUpdated":"Jun 4, 2016 5:55:50 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1465050225424_-227447190","id":"20160604-172345_1565275906","dateCreated":"Jun 4, 2016 5:23:45 PM","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:28"},{"title":"Clean data","text":"%sql\n\n-- We first wanted to \"clean\" the data and create a good training/test set so we could check any hypothesis we have...\n\nCREATE table events_analyzed_naive stored as parquet as     \n with data_with_counts as (select nvl(sum(case when `type` = 'click' then 1 else 0 end) \n                                          over (partition by t.advertiser_identifier, t.user_identifier order by create_date range between 7776000 preceding and current row), 0) as number_clicks_last_90_days, \n                                          \n                                  sum(case when create_date >= '2016-03-25' and create_date < '2016-04-23' and `type` = 'click' then 1 else 0 end)\n                                      over (partition by t.advertiser_identifier, t.user_identifier)                                                                              as number_clicks_month_from_week_4,\n                                  case when create_date >= '2016-03-25' and create_date < '2016-04-01' then 1 else 0 end                                                          as is_week_4,\n                                  \n                                  sum(case when create_date >= '2016-03-18' and create_date < '2016-04-16' and `type` = 'click' then 1 else 0 end)\n                                      over (partition by t.advertiser_identifier, t.user_identifier)                                                                              as number_clicks_month_from_week_3,\n                                  case when create_date >= '2016-03-18' and create_date < '2016-03-25' then 1 else 0 end                                                          as is_week_3,\n\n                                  sum(case when create_date >= '2016-03-11' and create_date < '2016-04-09' and `type` = 'click' then 1 else 0 end)\n                                      over (partition by t.advertiser_identifier, t.user_identifier)                                                                              as number_clicks_month_from_week_2,\n                                  case when create_date >= '2016-03-11' and create_date < '2016-03-18' then 1 else 0 end                                                          as is_week_2,\n                                  \n                                  sum(case when create_date >= '2016-03-04' and create_date < '2016-04-02' and `type` = 'click' then 1 else 0 end)\n                                      over (partition by t.advertiser_identifier, t.user_identifier)                                                                              as number_clicks_month_from_week_1,\n                                  case when create_date >= '2016-03-04' and create_date < '2016-03-11' then 1 else 0 end                                                          as is_week_1,\n                                  \n                                  t.*\n                                 \n                            from events t\n                            where event_month in (1,2,3)) -- We removed december from the dataset to avoid mistakes from christmas\nselect t.campaign_id,\n       t.advertiser_identifier,\n       t.create_date,\n       t.`type` as event_type,\n       t.value,\n       t.quantity,\n       t.country,\n       client_ip,\n       t.device,\n       t.event_month\n\nfrom   data_with_counts t\nwhere (is_week_4=1 and number_clicks_last_90_days > 0 and `type` != 'click' and number_clicks_month_from_week_4 = 0)\nor    (is_week_3=1 and number_clicks_last_90_days > 0 and `type` != 'click' and number_clicks_month_from_week_3 = 0)\nor    (is_week_2=1 and number_clicks_last_90_days > 0 and `type` != 'click' and number_clicks_month_from_week_2 = 0)\nor    (is_week_1=1 and number_clicks_last_90_days > 0 and `type` != 'click' and number_clicks_month_from_week_1 = 0)\n","dateUpdated":"Jun 4, 2016 5:58:14 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql","editorHide":false,"tableHide":true,"title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464938359120_376006514","id":"20160603-101919_1889481881","result":{"code":"SUCCESS","type":"TABLE","msg":"campaign_id\tadvertiser_identifier\tcreate_date\tevent_type\tvalue\tquantity\tcountry\tclient_ip\tdevice\tevent_month\n\t0159eab8-dcaf-4930-81a5-c6ed00acf80b\t2016-03-04 03:37:48.0\t7b175c0ae9d218ffc2774c31c128af6a\t225\t1.0\tUnited States\t92c17880d7e31177ab6e8f3b8b4fb6cb\t1\t3\n\t0159eab8-dcaf-4930-81a5-c6ed00acf80b\t2016-03-12 05:03:16.0\t7b175c0ae9d218ffc2774c31c128af6a\t37.47\t1.0\tUnited States\t850ed7ea5f95b495c16cb2a632e9c4d4\t3\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-04 23:47:03.0\t92b1e2074b93dd3c42f9a309aaf5f5e9\t78\t1.0\tUnited States\t7fe0a8e58892f5374debd2e8400ae3e7\t1\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-11 23:35:01.0\t92b1e2074b93dd3c42f9a309aaf5f5e9\t82.95\t1.0\tUnited States\tf6e2df60b607ae1b66b70965f40f2a08\t1\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-21 18:00:44.0\tee1d635476d02381855ee06e6a9e95cf\t0\t1.0\tUnited States\te66b2b8048456ddf23db73f1378cbdd6\t2\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-14 21:47:47.0\tee1d635476d02381855ee06e6a9e95cf\t0\t1.0\tUnited States\t8ca5c1a766d92e959d57a5e316926583\t1\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-24 05:49:57.0\tee1d635476d02381855ee06e6a9e95cf\t0\t1.0\tUnited States\t0f199a2f5fdcbf9a1d43d0f3e099e737\t2\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-29 15:42:45.0\tee1d635476d02381855ee06e6a9e95cf\t0\t1.0\tUnited States\t9ec1fe4985befd82518795a0c5a179a5\t1\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-22 18:29:17.0\tee1d635476d02381855ee06e6a9e95cf\t0\t1.0\tUnited States\te670443e97b2486835e783320304677a\t1\t3\n\t01cec79b-88ce-4977-b8ab-b860f52ed3c8\t2016-03-06 23:38:21.0\t92b1e2074b93dd3c42f9a309aaf5f5e9\t28\t1.0\tUnited States\t1cbd2134efe04e5932ee90a7a35859cd\t1\t3\n","comment":"","msgTable":[[{"key":"advertiser_identifier","value":""},{"key":"advertiser_identifier","value":"0159eab8-dcaf-4930-81a5-c6ed00acf80b"},{"key":"advertiser_identifier","value":"2016-03-04 03:37:48.0"},{"key":"advertiser_identifier","value":"7b175c0ae9d218ffc2774c31c128af6a"},{"key":"advertiser_identifier","value":"225"},{"key":"advertiser_identifier","value":"1.0"},{"key":"advertiser_identifier","value":"United States"},{"key":"advertiser_identifier","value":"92c17880d7e31177ab6e8f3b8b4fb6cb"},{"key":"advertiser_identifier","value":"1"},{"key":"advertiser_identifier","value":"3"}],[{"key":"create_date","value":""},{"key":"create_date","value":"0159eab8-dcaf-4930-81a5-c6ed00acf80b"},{"key":"create_date","value":"2016-03-12 05:03:16.0"},{"key":"create_date","value":"7b175c0ae9d218ffc2774c31c128af6a"},{"key":"create_date","value":"37.47"},{"key":"create_date","value":"1.0"},{"key":"create_date","value":"United States"},{"key":"create_date","value":"850ed7ea5f95b495c16cb2a632e9c4d4"},{"key":"create_date","value":"3"},{"key":"create_date","value":"3"}],[{"key":"event_type","value":""},{"key":"event_type","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"event_type","value":"2016-03-04 23:47:03.0"},{"key":"event_type","value":"92b1e2074b93dd3c42f9a309aaf5f5e9"},{"key":"event_type","value":"78"},{"key":"event_type","value":"1.0"},{"key":"event_type","value":"United States"},{"key":"event_type","value":"7fe0a8e58892f5374debd2e8400ae3e7"},{"key":"event_type","value":"1"},{"key":"event_type","value":"3"}],[{"key":"value","value":""},{"key":"value","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"value","value":"2016-03-11 23:35:01.0"},{"key":"value","value":"92b1e2074b93dd3c42f9a309aaf5f5e9"},{"key":"value","value":"82.95"},{"key":"value","value":"1.0"},{"key":"value","value":"United States"},{"key":"value","value":"f6e2df60b607ae1b66b70965f40f2a08"},{"key":"value","value":"1"},{"key":"value","value":"3"}],[{"key":"quantity","value":""},{"key":"quantity","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"quantity","value":"2016-03-21 18:00:44.0"},{"key":"quantity","value":"ee1d635476d02381855ee06e6a9e95cf"},{"key":"quantity","value":"0"},{"key":"quantity","value":"1.0"},{"key":"quantity","value":"United States"},{"key":"quantity","value":"e66b2b8048456ddf23db73f1378cbdd6"},{"key":"quantity","value":"2"},{"key":"quantity","value":"3"}],[{"key":"country","value":""},{"key":"country","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"country","value":"2016-03-14 21:47:47.0"},{"key":"country","value":"ee1d635476d02381855ee06e6a9e95cf"},{"key":"country","value":"0"},{"key":"country","value":"1.0"},{"key":"country","value":"United States"},{"key":"country","value":"8ca5c1a766d92e959d57a5e316926583"},{"key":"country","value":"1"},{"key":"country","value":"3"}],[{"key":"client_ip","value":""},{"key":"client_ip","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"client_ip","value":"2016-03-24 05:49:57.0"},{"key":"client_ip","value":"ee1d635476d02381855ee06e6a9e95cf"},{"key":"client_ip","value":"0"},{"key":"client_ip","value":"1.0"},{"key":"client_ip","value":"United States"},{"key":"client_ip","value":"0f199a2f5fdcbf9a1d43d0f3e099e737"},{"key":"client_ip","value":"2"},{"key":"client_ip","value":"3"}],[{"key":"device","value":""},{"key":"device","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"device","value":"2016-03-29 15:42:45.0"},{"key":"device","value":"ee1d635476d02381855ee06e6a9e95cf"},{"key":"device","value":"0"},{"key":"device","value":"1.0"},{"key":"device","value":"United States"},{"key":"device","value":"9ec1fe4985befd82518795a0c5a179a5"},{"key":"device","value":"1"},{"key":"device","value":"3"}],[{"key":"event_month","value":""},{"key":"event_month","value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"key":"event_month","value":"2016-03-22 18:29:17.0"},{"key":"event_month","value":"ee1d635476d02381855ee06e6a9e95cf"},{"key":"event_month","value":"0"},{"key":"event_month","value":"1.0"},{"key":"event_month","value":"United States"},{"key":"event_month","value":"e670443e97b2486835e783320304677a"},{"key":"event_month","value":"1"},{"key":"event_month","value":"3"}],[{"value":""},{"value":"01cec79b-88ce-4977-b8ab-b860f52ed3c8"},{"value":"2016-03-06 23:38:21.0"},{"value":"92b1e2074b93dd3c42f9a309aaf5f5e9"},{"value":"28"},{"value":"1.0"},{"value":"United States"},{"value":"1cbd2134efe04e5932ee90a7a35859cd"},{"value":"1"},{"value":"3"}]],"columnNames":[{"name":"campaign_id","index":0,"aggr":"sum"},{"name":"advertiser_identifier","index":1,"aggr":"sum"},{"name":"create_date","index":2,"aggr":"sum"},{"name":"event_type","index":3,"aggr":"sum"},{"name":"value","index":4,"aggr":"sum"},{"name":"quantity","index":5,"aggr":"sum"},{"name":"country","index":6,"aggr":"sum"},{"name":"client_ip","index":7,"aggr":"sum"},{"name":"device","index":8,"aggr":"sum"},{"name":"event_month","index":9,"aggr":"sum"}],"rows":[["","0159eab8-dcaf-4930-81a5-c6ed00acf80b","2016-03-04 03:37:48.0","7b175c0ae9d218ffc2774c31c128af6a","225","1.0","United States","92c17880d7e31177ab6e8f3b8b4fb6cb","1","3"],["","0159eab8-dcaf-4930-81a5-c6ed00acf80b","2016-03-12 05:03:16.0","7b175c0ae9d218ffc2774c31c128af6a","37.47","1.0","United States","850ed7ea5f95b495c16cb2a632e9c4d4","3","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-04 23:47:03.0","92b1e2074b93dd3c42f9a309aaf5f5e9","78","1.0","United States","7fe0a8e58892f5374debd2e8400ae3e7","1","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-11 23:35:01.0","92b1e2074b93dd3c42f9a309aaf5f5e9","82.95","1.0","United States","f6e2df60b607ae1b66b70965f40f2a08","1","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-21 18:00:44.0","ee1d635476d02381855ee06e6a9e95cf","0","1.0","United States","e66b2b8048456ddf23db73f1378cbdd6","2","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-14 21:47:47.0","ee1d635476d02381855ee06e6a9e95cf","0","1.0","United States","8ca5c1a766d92e959d57a5e316926583","1","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-24 05:49:57.0","ee1d635476d02381855ee06e6a9e95cf","0","1.0","United States","0f199a2f5fdcbf9a1d43d0f3e099e737","2","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-29 15:42:45.0","ee1d635476d02381855ee06e6a9e95cf","0","1.0","United States","9ec1fe4985befd82518795a0c5a179a5","1","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-22 18:29:17.0","ee1d635476d02381855ee06e6a9e95cf","0","1.0","United States","e670443e97b2486835e783320304677a","1","3"],["","01cec79b-88ce-4977-b8ab-b860f52ed3c8","2016-03-06 23:38:21.0","92b1e2074b93dd3c42f9a309aaf5f5e9","28","1.0","United States","1cbd2134efe04e5932ee90a7a35859cd","1","3"]]},"dateCreated":"Jun 3, 2016 10:19:19 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:29"},{"title":"Sum of money per day","text":"%sql\n\nselect date(create_Date)             as date,\n       sum(value)                    as total_value     \n\nfrom events_analyzed_naive t\ngroup by date(create_Date)\n","dateUpdated":"Jun 4, 2016 5:43:41 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1465051360540_580962800","id":"20160604-174240_248878870","dateCreated":"Jun 4, 2016 5:42:40 PM","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:30"},{"title":"Average weekly Money in funnel","text":"%sql\n\nselect sum(value)/4\nfrom  events_analyzed_naive\n","dateUpdated":"Jun 4, 2016 5:44:33 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"_c0","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"_c0","index":0,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","tableHide":true,"editorHide":false,"title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464938359121_375621765","id":"20160603-101919_1612423512","result":{"code":"SUCCESS","type":"TABLE","msg":"_c0\n2.6373938885504204E8\n","comment":"","msgTable":[[{"value":"2.6373938885504204E8"}]],"columnNames":[{"name":"_c0","index":0,"aggr":"sum"}],"rows":[["2.6373938885504204E8"]]},"dateCreated":"Jun 3, 2016 10:19:19 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31"},{"title":"Standard deviation of Income By day of week","text":"%sql\nwith train as (select date(create_Date)             as date,\n                      date_format(create_date, 'E') as day_of_week,\n                      advertiser_identifier,\n                      sum(value)                    as total_value     \n               \n               from events_analyzed_naive t\n               where not (create_date >= '2016-03-25' and create_date < '2016-04-01')\n               group by date(create_Date),\n                        date_format(create_date, 'E'),\n                        advertiser_identifier)\n                        \nselect round(std_total_value) as dist,\n       count(*)               as num_values\nfrom (select day_of_week, \n             advertiser_identifier,\n             avg(total_value) as avg_value,\n             std(total_value) as std_total_value\n      from train\n      group by day_of_week,\n               advertiser_identifier\n     ) t\nwhere round(std_total_value) != 0\ngroup by round(std_total_value)\norder by dist\n","dateUpdated":"Jun 4, 2016 5:45:07 PM","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"keys":[],"values":[{"name":"num_values","index":1,"aggr":"sum","$$hashKey":"object:246"}],"groups":[],"scatter":{"yAxis":{"name":"num_values","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464938359122_376776012","id":"20160603-101919_650850454","result":{"code":"SUCCESS","type":"TABLE","msg":"dist\tnum_values\n1.0\t277\n2.0\t288\n3.0\t204\n4.0\t116\n5.0\t91\n6.0\t73\n7.0\t58\n8.0\t42\n9.0\t41\n10.0\t27\n11.0\t20\n12.0\t13\n13.0\t11\n14.0\t12\n15.0\t7\n16.0\t10\n17.0\t6\n18.0\t7\n19.0\t5\n20.0\t7\n21.0\t7\n22.0\t5\n23.0\t2\n24.0\t5\n25.0\t7\n26.0\t3\n27.0\t3\n28.0\t3\n29.0\t2\n30.0\t2\n31.0\t1\n34.0\t3\n38.0\t1\n39.0\t1\n41.0\t1\n43.0\t2\n47.0\t1\n48.0\t2\n49.0\t1\n62.0\t1\n69.0\t2\n71.0\t1\n72.0\t1\n129.0\t1\n143.0\t1\n181.0\t1\n186.0\t1\n206.0\t1\n214.0\t1\n","comment":"","msgTable":[[{"key":"num_values","value":"1.0"},{"key":"num_values","value":"277"}],[{"value":"2.0"},{"value":"288"}],[{"value":"3.0"},{"value":"204"}],[{"value":"4.0"},{"value":"116"}],[{"value":"5.0"},{"value":"91"}],[{"value":"6.0"},{"value":"73"}],[{"value":"7.0"},{"value":"58"}],[{"value":"8.0"},{"value":"42"}],[{"value":"9.0"},{"value":"41"}],[{"value":"10.0"},{"value":"27"}],[{"value":"11.0"},{"value":"20"}],[{"value":"12.0"},{"value":"13"}],[{"value":"13.0"},{"value":"11"}],[{"value":"14.0"},{"value":"12"}],[{"value":"15.0"},{"value":"7"}],[{"value":"16.0"},{"value":"10"}],[{"value":"17.0"},{"value":"6"}],[{"value":"18.0"},{"value":"7"}],[{"value":"19.0"},{"value":"5"}],[{"value":"20.0"},{"value":"7"}],[{"value":"21.0"},{"value":"7"}],[{"value":"22.0"},{"value":"5"}],[{"value":"23.0"},{"value":"2"}],[{"value":"24.0"},{"value":"5"}],[{"value":"25.0"},{"value":"7"}],[{"value":"26.0"},{"value":"3"}],[{"value":"27.0"},{"value":"3"}],[{"value":"28.0"},{"value":"3"}],[{"value":"29.0"},{"value":"2"}],[{"value":"30.0"},{"value":"2"}],[{"value":"31.0"},{"value":"1"}],[{"value":"34.0"},{"value":"3"}],[{"value":"38.0"},{"value":"1"}],[{"value":"39.0"},{"value":"1"}],[{"value":"41.0"},{"value":"1"}],[{"value":"43.0"},{"value":"2"}],[{"value":"47.0"},{"value":"1"}],[{"value":"48.0"},{"value":"2"}],[{"value":"49.0"},{"value":"1"}],[{"value":"62.0"},{"value":"1"}],[{"value":"69.0"},{"value":"2"}],[{"value":"71.0"},{"value":"1"}],[{"value":"72.0"},{"value":"1"}],[{"value":"129.0"},{"value":"1"}],[{"value":"143.0"},{"value":"1"}],[{"value":"181.0"},{"value":"1"}],[{"value":"186.0"},{"value":"1"}],[{"value":"206.0"},{"value":"1"}],[{"value":"214.0"},{"value":"1"}]],"columnNames":[{"name":"dist","index":0,"aggr":"sum","$$hashKey":"object:136"},{"name":"num_values","index":1,"aggr":"sum","$$hashKey":"object:137"}],"rows":[["1.0","277"],["2.0","288"],["3.0","204"],["4.0","116"],["5.0","91"],["6.0","73"],["7.0","58"],["8.0","42"],["9.0","41"],["10.0","27"],["11.0","20"],["12.0","13"],["13.0","11"],["14.0","12"],["15.0","7"],["16.0","10"],["17.0","6"],["18.0","7"],["19.0","5"],["20.0","7"],["21.0","7"],["22.0","5"],["23.0","2"],["24.0","5"],["25.0","7"],["26.0","3"],["27.0","3"],["28.0","3"],["29.0","2"],["30.0","2"],["31.0","1"],["34.0","3"],["38.0","1"],["39.0","1"],["41.0","1"],["43.0","2"],["47.0","1"],["48.0","2"],["49.0","1"],["62.0","1"],["69.0","2"],["71.0","1"],["72.0","1"],["129.0","1"],["143.0","1"],["181.0","1"],["186.0","1"],["206.0","1"],["214.0","1"]]},"dateCreated":"Jun 3, 2016 10:19:19 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:32"},{"title":"Model Benchmark","text":"%sql\n\n-- First model simply says that any advertiser will make on average what he did on the last three weeks for the same day of week...\n\nwith train as (\n               select date(create_Date)             as date,\n                      date_format(create_date, 'E') as day_of_week,\n                      advertiser_identifier         as advertiser_identifier,\n                      sum(value)                    as total_value     \n               \n               from events_analyzed_naive t\n               where not (create_date >= '2016-03-25' and create_date < '2016-04-01')\n               group by date(create_Date),\n                        date_format(create_date, 'E'),\n                        advertiser_identifier\n              ),\n     predicted as (\n                    select day_of_week             as day_of_week, \n                           advertiser_identifier   as advertiser_identifier,\n                           avg(total_value)        as avg_value,\n                           std(total_value)        as std_total_value\n                    from train\n                    group by day_of_week,\n                             advertiser_identifier\n                  ),\n     test as (\n               select date_format(create_date, 'E') as day_of_week,\n                      advertiser_identifier         as advertiser_identifier,\n                      sum(value)                    as total_value     \n               \n               from events_analyzed_naive t\n               where create_date >= '2016-03-25' and create_date < '2016-04-01'\n               group by date_format(create_date, 'E'),\n                        advertiser_identifier\n             ),\n     union_data as (\n                    select coalesce(t.day_of_week, p.day_of_week)                     as day_of_week,\n                           coalesce(t.advertiser_identifier, p.advertiser_identifier) as advertiser_identifier, \n                           nvl(p.avg_value, 0)                                        as predicted_value, \n                           nvl(t.total_value, 0)                                      as real_value\n                    from test t\n                    full outer join predicted p \n                    on   t.day_of_week           = p.day_of_week\n                    and  t.advertiser_identifier = p.advertiser_identifier\n                  )\n                  \nselect sum(abs(predicted_value-real_value))\nfrom union_data \n","dateUpdated":"Jun 4, 2016 5:58:14 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"_c0","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"_c0","index":0,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","title":true,"editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464938359122_376776012","id":"20160603-101919_1124262353","result":{"code":"SUCCESS","type":"TABLE","msg":"_c0\n7.42389246916667E7\n","comment":"","msgTable":[[{"value":"7.42389246916667E7"}]],"columnNames":[{"name":"_c0","index":0,"aggr":"sum"}],"rows":[["7.42389246916667E7"]]},"dateCreated":"Jun 3, 2016 10:19:19 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:33"},{"title":"Store prediction to csv","text":"\nval df = sqlContext.sql(\"\"\"\nwith train as (\n               select date(create_Date)             as date,\n                      date_format(create_date, 'E') as day_of_week,\n                      advertiser_identifier         as advertiser_identifier,\n                      sum(value)                    as total_value\n               from events_analyzed_naive t\n               group by date(create_Date),\n                        date_format(create_date, 'E'),\n                        advertiser_identifier\n              ),\n     predicted as (\n                    select day_of_week            as day_of_week, \n                           advertiser_identifier  as advertiser_identifier,\n                           avg(total_value)       as avg_value,\n                           std(total_value)       as std_total_value\n                    from train\n                    group by day_of_week,\n                             advertiser_identifier\n                    \n                  )\nselect advertiser_identifier,\n      case when day_of_week = 'Fri' then '4/1/2016' \n           when day_of_week = 'Sat' then '4/2/2016' \n           when day_of_week = 'Sun' then '4/3/2016' \n           when day_of_week = 'Mon' then '4/4/2016' \n           when day_of_week = 'Tue' then '4/5/2016' \n           when day_of_week = 'Wed' then '4/6/2016' \n           when day_of_week = 'Thu' then '4/7/2016' \n      end as date,\n      round(avg_value, 3) as predicted_revenue\nfrom predicted p \nwhere avg_value != 0\norder by advertiser_identifier, date\n\"\"\").coalesce(1)\n\ndf.write.format(\"com.databricks.spark.csv\").save(\"/tmp/team6_naive_model.csv\")\n","dateUpdated":"Jun 4, 2016 5:55:36 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"day_of_week","index":0,"aggr":"sum"}],"values":[{"name":"_c1","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"day_of_week","index":0,"aggr":"sum"},"yAxis":{"name":"_c1","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/scala","editorHide":false,"tableHide":true,"title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464938359122_376776012","id":"20160603-101919_1036078099","result":{"code":"SUCCESS","type":"TEXT","msg":"df: org.apache.spark.sql.DataFrame = [advertiser_identifier: string, date: string, predicted_revenue: double]\n"},"dateCreated":"Jun 3, 2016 10:19:19 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34"},{"dateUpdated":"Jun 3, 2016 10:19:24 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorHide":true,"tableHide":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464938359122_376776012","id":"20160603-101919_15543186","dateCreated":"Jun 3, 2016 10:19:19 AM","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:35"}],"name":"Naive Solution - final","id":"2BPHGS69F","angularObjects":{"2BH6PATWH":[],"2BDRMRYRB":[],"2BE3GJPX1":[],"2BDW2DVVX":[],"2BET4M1WZ":[],"2BGH9HUVV":[],"2BDMNFWVG":[],"2BFZ78XNA":[],"2BFACPQ95":[],"2BFJ9Z8U8":[],"2BF8MN2JC":[],"2BEEP95N4":[],"2BFH6D5UN":[],"2BH7DX15H":[]},"config":{"looknfeel":"default"},"info":{}}